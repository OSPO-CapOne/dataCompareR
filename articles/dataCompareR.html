<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • dataCompareR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="dataCompareR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dataCompareR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/dataCompareR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/capitalone/dataCompareR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="dataCompareR_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>dataCompareR vignette</h1>
                        <h4 class="author">Rob Noble-Eddy</h4>
            
            <h4 class="date">2021-09-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/capitalone/dataCompareR/blob/master/vignettes/dataCompareR.Rmd"><code>vignettes/dataCompareR.Rmd</code></a></small>
      <div class="hidden name"><code>dataCompareR.Rmd</code></div>

    </div>

    
    
<!---
# SPDX-Copyright: Copyright (c) Capital One Services, LLC 
# SPDX-License-Identifier: Apache-2.0 
# Copyright 2017 Capital One Services, LLC 
#
# Licensed under the Apache License, Version 2.0 (the "License"); 
# you may not use this file except in compliance with the License. 
#
# You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 
#
# Unless required by applicable law or agreed to in writing, software distributed 
# under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS
# OF ANY KIND, either express or implied.
-->
<p>Here we offer end-to-end examples of using dataCompareR and, for those who want to know, to provide details of how the package performs the comparison.</p>
<div id="datacomparer-examples" class="section level2">
<h2 class="hasAnchor">
<a href="#datacomparer-examples" class="anchor"></a>dataCompareR examples</h2>
<div id="matching-without-a-key" class="section level3">
<h3 class="hasAnchor">
<a href="#matching-without-a-key" class="anchor"></a>Matching without a key</h3>
<p>For the purpose of this vignette we’ll intentionally modify iris to use for our comparison.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/capitalone/dataCompareR">dataCompareR</a></span><span class="op">)</span>

<span class="co"># We'll use iris for our comparison</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa
## 4          4.6         3.1          1.5         0.2  setosa
## 5          5.0         3.6          1.4         0.2  setosa
## 6          5.4         3.9          1.7         0.4  setosa</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make a copy of iris</span>
<span class="va">iris2</span> <span class="op">&lt;-</span> <span class="va">iris</span>
<span class="co"># And change it, first by subsetting just the first 140 rows</span>
<span class="va">iris2</span> <span class="op">&lt;-</span> <span class="va">iris2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">140</span>,<span class="op">]</span>
<span class="co"># then removing the Petal.Width column</span>
<span class="va">iris2</span><span class="op">$</span><span class="va">Petal.Width</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="co"># And then changing some values</span>
<span class="va">iris2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">iris2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span></code></pre></div>
<p>And then run a comparison using the <code>rCompare</code> function</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># run the comparison</span>
<span class="va">compIris</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rCompare.html">rCompare</a></span><span class="op">(</span><span class="va">iris</span>, <span class="va">iris2</span><span class="op">)</span></code></pre></div>
<pre><code>## Running rCompare...</code></pre>
<pre><code>## Warning: `select_()` was deprecated in dplyr 0.7.0.
## Please use `select()` instead.</code></pre>
<p><code>rCompare</code> returns an S3 object which you can use with summary and print. Summary is a good way to check the results</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Check the results</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">compIris</span><span class="op">)</span></code></pre></div>
<pre><code>## dataCompareR is generating the summary...</code></pre>
<pre><code>## 
## Data Comparison
## ===============
## 
## Date comparison run: 2021-09-05 16:53:52  
## Comparison run on R version 4.1.1 (2021-08-10)  
## With dataCompareR version 0.1.3  
## 
## 
## Meta Summary
## ============
## 
## 
## |Dataset Name |Number of Rows |Number of Columns |
## |:------------|:--------------|:-----------------|
## |iris         |150            |5                 |
## |iris2        |140            |4                 |
## 
## 
## Variable Summary
## ================
## 
## Number of columns in common: 4  
## Number of columns only in iris: 1  
## Number of columns only in iris2: 0  
## Number of columns with a type mismatch: 0  
## No match key used, comparison is by row
## 
## 
## Columns only in iris: PETAL.WIDTH  
## Columns in both : PETAL.LENGTH, SEPAL.LENGTH, SEPAL.WIDTH, SPECIES  
## 
## Row Summary
## ===========
## 
## Total number of rows read from iris: 150  
## Total number of rows read from iris2: 140    
## Number of rows in common: 140  
## Number of rows dropped from iris: 10  
## Number of rows dropped from  iris2: 0  
## 
## 
## Data Values Comparison Summary
## ==============================
## 
## Number of columns compared with ALL rows equal: 3  
## Number of columns compared with SOME rows unequal: 1  
## Number of columns with missing value differences: 0  
## 
## Columns with all rows equal : PETAL.LENGTH, SEPAL.WIDTH, SPECIES
## 
## Summary of columns with some rows unequal: 
## 
## 
## 
## |Column       |Type (in iris) |Type (in iris2) | # differences|Max difference | # NAs|
## |:------------|:--------------|:---------------|-------------:|:--------------|-----:|
## |SEPAL.LENGTH |double         |double          |            10|1              |     0|
## 
## 
## 
## Unequal column details
## ======================
## 
## 
## 
## #### Column -  SEPAL.LENGTH
## Showing sample of size 5
## 
## 
## 
## |   | SEPAL.LENGTH (iris)| SEPAL.LENGTH (iris2)|Type (iris) |Type (iris2) | Difference|
## |:--|-------------------:|--------------------:|:-----------|:------------|----------:|
## |1  |                 4.9|                  5.9|double      |double       |         -1|
## |2  |                 5.0|                  6.0|double      |double       |         -1|
## |3  |                 4.7|                  5.7|double      |double       |         -1|
## |4  |                 5.0|                  6.0|double      |double       |         -1|
## |5  |                 4.6|                  5.6|double      |double       |         -1|</code></pre>
<p>Or you save a copy of the report using <code>saveReport</code></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Write the summary to a file</span>
<span class="fu"><a href="../reference/saveReport.html">saveReport</a></span><span class="op">(</span><span class="va">compIris</span>, reportName <span class="op">=</span> <span class="st">'compIris'</span><span class="op">)</span></code></pre></div>
</div>
<div id="comparison-with-a-key" class="section level3">
<h3 class="hasAnchor">
<a href="#comparison-with-a-key" class="anchor"></a>Comparison with a key</h3>
<p>In the first example, we compared our data based on it’s order. What if want to match our data of a key? We’ll produce another test data set based on the pressure dataset</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># We'll use the pressure dataset for comparison</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">pressure</span><span class="op">)</span></code></pre></div>
<pre><code>##   temperature pressure
## 1           0   0.0002
## 2          20   0.0012
## 3          40   0.0060
## 4          60   0.0300
## 5          80   0.0900
## 6         100   0.2700</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make a copy of pressure</span>
<span class="va">pressure2</span> <span class="op">&lt;-</span> <span class="va">pressure</span>
<span class="co"># And change it, first by randomising the row order</span>
<span class="va">pressure2</span> <span class="op">&lt;-</span> <span class="va">pressure2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pressure2</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span>
<span class="co"># then changing just one element, so for temperature of</span>
<span class="va">pressure2</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">]</span></code></pre></div>
<pre><code>## [1] 40</code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># We modify pressure to be twice as large</span>
<span class="va">pressure2</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pressure2</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="fl">2</span></code></pre></div>
<p>Run the comparison with <code>rCompare</code> specifying that we want to match on temperature</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># run the comparison</span>
<span class="va">compPressure</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rCompare.html">rCompare</a></span><span class="op">(</span><span class="va">pressure</span>, <span class="va">pressure2</span>, keys <span class="op">=</span> <span class="st">'temperature'</span><span class="op">)</span></code></pre></div>
<pre><code>## Running rCompare...</code></pre>
<pre><code>## Warning: `arrange_()` was deprecated in dplyr 0.7.0.
## Please use `arrange()` instead.
## See vignette('programming') for more help</code></pre>
<p>And this time, we’ll choose to get a shorter summary using <code>print</code></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Check the results - use print for a quick summary</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">compPressure</span><span class="op">)</span></code></pre></div>
<pre><code>## All columns were compared, all rows were compared 
## There are  1 mismatched variables:
## First and last 5 observations for the  1 mismatched variables
##   TEMPERATURE valueA valueB variable  typeA  typeB diffAB
## 1          40  0.006  0.012 PRESSURE double double -0.006</code></pre>
<p>We can also extract the mismatching data to explore futher using <code>generateMismatchData</code> which generates a list containing two data frames, each having the missing rows from the comparison.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># use generateMismatchData to pull out the mismatching rows from each table</span>
<span class="va">mismatches</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateMismatchData.html">generateMismatchData</a></span><span class="op">(</span><span class="va">compPressure</span>, <span class="va">pressure</span>, <span class="va">pressure2</span><span class="op">)</span>

<span class="va">mismatches</span></code></pre></div>
<pre><code>## $pressure_mm
##   TEMPERATURE PRESSURE
## 1          40    0.006
## 
## $pressure2_mm
##   TEMPERATURE PRESSURE
## 1          40    0.012</code></pre>
</div>
</div>
<div id="internal-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#internal-functions" class="anchor"></a>Internal functions</h2>
<p>It is possible to use the other functions not exposed to the end user through the 3 colons format like <code>dataCompareR:::functionName</code>. Please take care when using them, as some of the checks are done up front, so they may make assumptions on the input.</p>
</div>
<div id="datacomparer-workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#datacomparer-workflow" class="anchor"></a>dataCompareR workflow</h2>
<p>The aspects of the dataCompareR::rCompare function that matter to the end user are:-</p>
<ol style="list-style-type: decimal">
<li>Coerce the two data objects provided to data frames (if required).
<ul>
<li>Coercion uses <code>as.data.frame</code>. If you need more advanced coercion, please do this before calling dataCompareR.</li>
</ul>
</li>
<li>Run data validation and cleaning
<ul>
<li>Currently the validation step is fairly minimal, mainly confirming that any match key fields are present in both data sets.</li>
<li>Cleaning consists of a few steps (these are run on a copy of the data passed to dataCompareR - the original data is unchanged)
<ol style="list-style-type: decimal">
<li>Convert factors to strings, to make for a clearer comparison</li>
<li>Tidy up column names (trim white space, convert to upper case)</li>
<li>(Optional) Trim strings to remove leading and trailing white space</li>
<li>(Optional) Round numerics to a specified number of decimal places</li>
</ol>
</li>
</ul>
</li>
<li>Match columns between tables
<ul>
<li>Columns present in both tables will be compared</li>
<li>Columns in only one of the two tables will not be compared, but will be recorded as missing in the output.</li>
</ul>
</li>
<li>Match rows. This step differs depending on whether a match key is specified.
<ul>
<li>
<em>No match key.</em>
<ul>
<li>Rows are matched based on order. If table A contains 100 rows and table B contains 150 rows, the last 50 rows from B will be dropped, and the comparison will proceed on the matching 100 rows. The fact that 50 rows were dropped will be recorded in the output.</li>
</ul>
</li>
<li>
<em>With match key.</em>
<ul>
<li>Rows are matched based on the key(s) provided. Rows that exist in both tables will be compared. Rows that do not exist in both tables will be dropped, with details of rows dropped recorded in the output.</li>
</ul>
</li>
</ul>
</li>
<li>Data comparison for matching columns/rows
<ul>
<li>Find which elements match between the remaining columns and row in the two data frames. The == operator is used to assess equality, with the exception of <code>NA</code> and <code>NaN</code>, which are handled in the following way
<ul>
<li>If both elements are <code>NA</code>, match is <code>TRUE</code>
</li>
<li>If both elements are <code>NaN</code>, match is <code>TRUE</code>
</li>
<li>If one element is <code>NA</code> and the other <code>NaN</code>, match is <code>FALSE</code>
</li>
<li>If one element is <code>NA</code>, and the other is a valid value, match is <code>FALSE</code>
</li>
<li>If one element is <code>NaN</code>, and the other is a valid value, match is <code>FALSE</code>
</li>
</ul>
</li>
<li>For mismatching elements, store details of the mismatch, and for numeric fields, store the difference between them</li>
</ul>
</li>
<li>Write everything that was learned in to an dataCompareR object</li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Sarah Johnston, Rob Noble-Eddy, Merlijn van Horssen, Krishan Bhasin, Sarah Pollicott.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
